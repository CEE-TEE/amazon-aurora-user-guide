# How Aurora Serverless v1 works<a name="aurora-serverless.how-it-works"></a>

Amazon Aurora offers two different DB engine modes aimed at two broadly different usage models\. 

The *provisioned* DB engine mode is designed for predictable workloads\. When you work with Aurora provisioned DB clusters, you choose your DB instance class size and several other configuration options\. For example, you can create one or more Aurora Replicas to increase read throughput\. If your workload changes, you can modify the DB instance class size and change the number of Aurora Replicas\. The provisioned model works well when you can adjust capacity in advance of expected consumption patterns\. 

The *serverless* DB engine mode is designed for a different usage pattern entirely\. For example, your database usage might be heavy for a short period of time, followed by long periods of light activity or no activity at all\. Some examples are retail websites with intermittent sales events, databases that produce reports when needed, development and testing environments, and new applications with uncertain requirements\. For cases such as these and many others, configuring capacity correctly in advance isn't always possible with the provisioned model\. It can also result in higher costs if you overprovision and have capacity that you don't use\.

By using Aurora Serverless v1, you can create a database endpoint without specifying the DB instance class size\. You specify only the minimum and maximum range for the Aurora Serverless v1 DB cluster's capacity\. The Aurora Serverless v1 database endpoint makes up a *router fleet* that supports continuous connections and distributes the workload among resources\. Aurora Serverless v1 scales the resources automatically based on your minimum and maximum capacity specifications\. 

You don't need to change your database client application code to use the router fleet\. Aurora Serverless v1 manages the connections automatically\. Scaling is fast thanks to a "warm" resources pool that's always ready to service requests\. Storage and processing are separate, so your Aurora Serverless v1 DB cluster can scale down to zero when it's finished processing workloads\. When your Aurora Serverless v1 DB cluster scales to zero, you're charged only for storage\.

**Topics**
+ [Aurora Serverless v1 architecture](#aurora-serverless.architecture)
+ [Autoscaling for Aurora Serverless](#aurora-serverless.how-it-works.auto-scaling)
+ [Automatic pause and resume for Aurora Serverless v1](#aurora-serverless.how-it-works.pause-resume)
+ [Timeout action for capacity changes](#aurora-serverless.how-it-works.timeout-action)
+ [Aurora Serverless v1 and parameter groups](#aurora-serverless.parameter-groups)
+ [Aurora Serverless v1 and maintenance](#aurora-serverless.maintenance)
+ [Aurora Serverless v1 and failover](#aurora-serverless.failover)
+ [Aurora Serverless v1 and snapshots](#aurora-serverless.snapshots)

## Aurora Serverless v1 architecture<a name="aurora-serverless.architecture"></a>

 The following image shows an overview the Aurora Serverless v1 architecture\.

![\[Aurora Serverless v1 Architecture\]](http://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/images/aurora-serverless-arch.png)

Instead of provisioning and managing database servers, you specify Aurora capacity units \(ACUs\)\. Each ACU is a combination of approximately 2 gigabytes \(GB\) of memory, corresponding CPU, and networking\. Database storage automatically scales from 10 gibibytes \(GiB\) to 128 tebibytes \(TiB\), the same as storage in a standard Aurora DB cluster\.

You can specify the minimum and maximum ACU\. The *minimum Aurora capacity unit* is the lowest ACU to which the DB cluster can scale down\. The *maximum Aurora capacity unit* is the highest ACU to which the DB cluster can scale up\. Based on your settings, Aurora Serverless v1 automatically creates scaling rules for thresholds for CPU utilization, connections, and available memory\. 

Aurora Serverless v1 manages the warm pool of resources in an AWS Region to minimize scaling time\. When Aurora Serverless v1 adds new resources to the Aurora DB cluster, it uses the router fleet to switch active client connections to the new resources\. At any specific time, you are only charged for the ACUs that are being actively used in your Aurora DB cluster\.

## Autoscaling for Aurora Serverless<a name="aurora-serverless.how-it-works.auto-scaling"></a>

The capacity allocated to your Aurora Serverless v1 DB cluster seamlessly scales up and down based on the load generated by your client application\. Here, load is CPU utilization and number of connections\. Aurora Serverless v1 can also scale to zero capacity when there are no connections if you enable the pause\-and\-resume option for your DB cluster's capacity settings\. For more information, see [Automatic pause and resume for Aurora Serverless v1](#aurora-serverless.how-it-works.pause-resume)\.

Aurora Serverless v1 scales up when capacity constraints are seen in CPU or connections\. It also scales up when it detects performance issues that can be resolved by scaling up\.

After scaling up, the cooldown period for scaling down is 15 minutes\. After scaling down, the cooldown period for scaling down again is 310 seconds\.

**Note**  
There is no cooldown period for scaling up\. Aurora Serverless v1 can scale up whenever necessary, including immediately after scaling up or scaling down\.

A *scaling point* is a point in time at which the database can safely initiate the scaling operation\. Under the following conditions, Aurora Serverless v1 might not be able to find a scaling point:
+ Long\-running queries or transactions are in progress
+ Temporary tables or table locks are in use

If Aurora Serverless v1 can't find a scaling point, its behavior depends on the DB cluster's timeout action setting\. Aurora Serverless v1 can force the change, or it can keep its original capacity if Aurora Serverless v1 can't find a scaling point before timing out\. For more information, see [Timeout action for capacity changes](#aurora-serverless.how-it-works.timeout-action)\. 

You can see scaling events in the details for a DB cluster in the AWS Management Console\. You can also monitor the current capacity allocated to the DB cluster by using the `ServerlessDatabaseCapacity` metric for Amazon CloudWatch\. 

During autoscaling, Aurora Serverless v1 resets the `EngineUptime` metric\. The reset metric value doesn't indicate any issues with seamless scaling and doesn't mean that any connections were dropped\. For more information about metrics, see [Monitoring Amazon Aurora metrics with Amazon CloudWatch](Aurora.Monitoring.md)\.

## Automatic pause and resume for Aurora Serverless v1<a name="aurora-serverless.how-it-works.pause-resume"></a>

You can choose to pause your Aurora Serverless v1 DB cluster after a given amount of time with no activity\. You specify the amount of time with no activity before the DB cluster is paused\. When you select this option, the default inactivity time is five minutes, but you can change this value\. This is an optional setting\. 

When the DB cluster is paused, no compute or memory activity occurs, and you are charged only for storage\. If database connections are requested when an Aurora Serverless DB cluster is paused, the DB cluster automatically resumes and services the connection requests\.

 When the DB cluster resumes activity, it has the same capacity as it had when Aurora paused the cluster\. The number of ACUs depends on how much Aurora scaled the cluster up or down before pausing it\. 

**Note**  
If a DB cluster is paused for more than seven days, the DB cluster might be backed up with a snapshot\. In this case, Aurora restores the DB cluster from the snapshot when there is a request to connect to it\.

## Timeout action for capacity changes<a name="aurora-serverless.how-it-works.timeout-action"></a>

When your Aurora Serverless v1 DB cluster needs to scale its capacity for the current workload, it first tries to find a scaling point for making the change\. The scaling point is the point at which your Aurora Serverless v1 DB cluster can safely start scaling to the resized capacity, without disrupting processing\. To learn more about how Aurora Serverless v1 finds a scaling point, see [Autoscaling for Aurora Serverless](#aurora-serverless.how-it-works.auto-scaling)\.

 If your Aurora Serverless v1 DB cluster can't find a scaling point within 5 minutes, it times out\. Aurora Serverless v1 then takes the appropriate action based on your Aurora Serverless v1 DB cluster's `TimeoutAction` setting, as follows: 
+ **Force the capacity change** – If your Aurora Serverless v1 DB cluster can't find a scaling point before timing out, the `TimeoutAction` value of `ForceApplyCapacityChange` causes Aurora Serverless v1 to force the change\. If Aurora Serverless v1 is processing a transaction, the transaction is interrupted and displays the following message:

  `ERROR 1105 (HY000): The last transaction was aborted due to Seamless Scaling. Please retry.`

  You can resubmit the transaction as soon as your Aurora Serverless v1 DB cluster is available\.
+ **Roll back the capacity change** – If your Aurora Serverless v1 DB cluster can't find the scaling point before timing out, the `TimeoutAction` value of `RollbackCapacityChange` causes Aurora Serverless v1 to stop looking for a scaling point\. Instead, your Aurora Serverless v1 DB cluster remains at its original capacity\. 

You choose the timeout action when you create your Aurora Serverless v1 DB using the AWS Management Console or the AWS CLI\. For more information, see [Creating an Aurora Serverless v1 DB cluster](aurora-serverless.create.md)\. 

**Important**  
 For clusters with many concurrent connections, the `ForceApplyCapacityChange` setting can result in dropped connections for long\-running queries and temporary tables\. We recommend you choose `ForceApplyCapacityChange` only if appropriate for your use case\. 

You can also modify the timeout action and other capacity settings at any time\. For more information, see [Modifying an Aurora Serverless v1 DB cluster](aurora-serverless.modifying.md)\. 

For an Aurora Serverless v1 DB cluster that's already been configured, you can quickly get the settings by using the [describe\-db\-clusters](https://docs.aws.amazon.com/cli/latest/reference/rds/describe-db-clusters.html) AWS CLI command\. For example, if you have an Aurora Serverless v1 DB cluster running in the US\-East \(Northern Virginia\) Region, you can run the following command\.

```
$ aws rds describe-db-clusters --region us-east-1
```

You can see all details for the DB clusters associated with your AWS account displayed, including the `ScalingConfigurationInfo` as shown in the following output extract\.

```
...
"ScalingConfigurationInfo": {
   "MinCapacity": 2,
   "MaxCapacity": 32,
   "AutoPause": true,
   "SecondsUntilAutoPause": 1200,
   "TimeoutAction": "RollbackCapacityChange"
 },
...
```

 As shown in the example, the Aurora Serverless v1 DB cluster as configured won't force the cluster to a new scaling point\. 

## Aurora Serverless v1 and parameter groups<a name="aurora-serverless.parameter-groups"></a>

When you create your Aurora Serverless v1 DB cluster, you can create a single database instance using your chosen DB engine\. Unlike Aurora provisioned DB clusters which can have multiple DB instances, Aurora Serverless v1 has a single read/write DB instance\. In provisioned Aurora DB clusters, each DB instance has an associated *DB parameter group* that you can configure differently from instance to instance\. An Aurora DB cluster has its own set of parameters in its associated *DB cluster parameter group*\. These two general types of parameter groups control different operational aspects, some cluster\-wide, some per instance, for a provisioned Aurora DB clusters\. 

Because Aurora Serverless v1 handles the DB instance capacity for you, parameter groups work differently for Aurora Serverless v1 DB clusters\. As it's processing your workloads and scaling database capacity, Aurora Serverless v1 changes various parameters in its DB cluster parameter group as needed to work best for the increased or decreased capacity\. That's why some of the default parameter values and other configuration details that you might use with other Aurora clusters don't apply for Aurora Serverless v1 clusters\.

Your Aurora Serverless v1 DB cluster has an associated DB cluster parameter group only\. Its DB cluster parameter group contains default values for any parameters that would typically be held in the DB parameter group of an Aurora provisioned DB cluster\. You can't change the values of the default parameter groups of either type, nor can you change the values of the parameter group\. However, you can create your own custom version of an Aurora DB cluster parameter group based on one of the provided DB cluster parameter groups and configure parameters as needed\. 

To get a list of available default parameters by engine type, see [Getting a list of parameters for Aurora Serverless v1](#aurora-serverless.parameter-groups.obtain-params-for-db-eng)

**To create a custom DB cluster parameter group for Aurora Serverless v1**

1. Sign in to the AWS Management Console and then open the Amazon RDS console at [https://console\.aws\.amazon\.com/rds/](https://console.aws.amazon.com/rds/)\.

1. Choose **Parameter groups**\.

1. Choose **Create parameter group** to open the Parameter group details pane\.

1. Choose the appropriate default DB cluster group for the DB engine you want to use for your Aurora Serverless v1 DB cluster\. Be sure you choose the following options: 

   1. For **Parameter group family**, choose the appropriate family for your chosen DB engine\. Be sure your selection has the prefix `aurora-` in its name\. 

   1. For **Type**, choose **DB Cluster Parameter Group**\.

   1. For **Group name** and **Description**, enter meaningful names for you or others who might need to work with your Aurora Serverless v1 DB cluster and its parameters\.

   1. Choose **Create**\. 

Your custom DB cluster parameter group is added to the list of Parameter groups available to your account in your AWS Region\. You can now use your custom DB cluster parameter group when you create new Aurora Serverless v1 DB clusters in the same Region\.

You can also modify your existing Aurora Serverless v1 DB clusters to use your custom DB cluster parameter group\. When you make changes such as this to an active DB cluster, Aurora Serverless v1 needs to start a seamless scale so that it can apply the parameter changes\. If the Aurora Serverless v1 DB cluster is paused, it resumes and starts scaling\. The scaling operation for a parameter group change uses the `ForceApplyCapacityChange` timeout action\. That means that if your Aurora Serverless v1 DB cluster can't find a scaling point before timing out, connections might be dropped\. For more information, see [Timeout action for capacity changes](#aurora-serverless.how-it-works.timeout-action)\. 

For more information about Aurora parameter groups, see [Working with DB parameter groups and DB cluster parameter groups](USER_WorkingWithParamGroups.md)\.

### Getting a list of parameters for Aurora Serverless v1<a name="aurora-serverless.parameter-groups.obtain-params-for-db-eng"></a>

By using the AWS CLI, you can get a list of default parameters available for Aurora Serverless v1 for specific DB engine\. You run the [describe\-engine\-default\-cluster\-parameters](https://docs.aws.amazon.com/cli/latest/reference/rds/describe-engine-default-cluster-parameters.html) command and query the AWS Region that you plan to use for your Aurora Serverless v1 DB cluster\. Or you can invoke the [DescribeEngineDefaultClusterParameters](https://docs.aws.amazon.com/AmazonRDS/latest/APIReference/API_DescribeEngineDefaultClusterParameters.html) API operation\.

Before using the CLI commands, configure your AWS CLI with your AWS Access Key ID and AWS Secret Access Key\. Also configure the AWS Region for your AWS CLI, to avoid needing to use the `--region` parameter in the command\. To learn how, see [Configuration basics](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html#cli-configure-quickstart-config) in the AWS Command Line Interface User Guide\. 

You can get a list of the parameters available for an Aurora MySQL Serverless DB cluster\. For Aurora MySQL 5\.7, the default DB cluster parameter group is `aurora5.6`, as shown in the following\.

For Linux, macOS, or Unix:

```
aws rds describe-engine-default-cluster-parameters \
  --db-parameter-group-family aurora5.6 --query \
  'EngineDefaults.Parameters[*].{ParameterName:ParameterName,SupportedEngineModes:SupportedEngineModes} | [?contains(SupportedEngineModes, `serverless`) == `true`] | [*].{param:ParameterName}' \
  --output text
```

For Windows:

```
aws rds describe-engine-default-cluster-parameters ^
   --db-parameter-group-family aurora5.6 --query ^
   "EngineDefaults.Parameters[*].{ParameterName:ParameterName,SupportedEngineModes:SupportedEngineModes} | [?contains(SupportedEngineModes, 'serverless') == `true`] | [*].{param:ParameterName}" ^
   --output text
```

You can get a list of default parameters from Aurora PostgreSQL Serverless DB cluster parameter group with the following AWS CLI command\. In this example, the default DB cluster parameter group being queried is `aurora-postgresql10`\.

For Linux, macOS, or Unix:

```
aws rds describe-engine-default-cluster-parameters \
  --db-parameter-group-family aurora-postgresql10 --query \
  'EngineDefaults.Parameters[*].{ParameterName:ParameterName,SupportedEngineModes:SupportedEngineModes} | [?contains(SupportedEngineModes, `serverless`) == `true`] | [*].{param:ParameterName}' \
  --output text
```

For Windows:

```
aws rds describe-engine-default-cluster-parameters --db-parameter-group-family aurora-postgresql10 --query ^
    "EngineDefaults.Parameters[*].{ParameterName:ParameterName,SupportedEngineModes:SupportedEngineModes} | [?contains(SupportedEngineModes, 'serverless') == `true`] | [*].{param:ParameterName}" ^
    --output text
```

For more information, see [Working with DB parameter groups and DB cluster parameter groups](USER_WorkingWithParamGroups.md)\.

## Aurora Serverless v1 and maintenance<a name="aurora-serverless.maintenance"></a>

Maintenance for Aurora Serverless v1 DB cluster, such as applying the latest features, fixes, and security updates, is performed automatically for you\. Unlike provisioned Aurora DB clusters, Aurora Serverless v1 doesn't have user\-settable maintenance windows\. However, it does have a maintenance window that you can view in the AWS Management Console in **Maintenance & backups** for your Aurora Serverless v1 DB cluster\. You can find the date and time that maintenance might be performed and if any maintenance is pending for your Aurora Serverless v1 DB cluster, as shown following\.

![\[Maintenance window for an example Aurora Serverless v1 DB cluster, not user settable, no pending maintenance\]](http://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/images/aurora-serverless-maintenance-window.png)

Whenever possible, Aurora Serverless v1 performs maintenance in a non\-disruptive manner\. When maintenance is required, your Aurora Serverless v1 DB cluster scales its capacity to handle the necessary operations\. Before scaling, Aurora Serverless v1 looks for a scaling point and it does so for up to seven days if necessary\.

At the end of each day that Aurora Serverless v1 can't find a scaling point, it creates a cluster event\. This event notifies you of the pending maintenance and the need to scale to perform maintenance\. The notification includes the date when the Aurora Serverless v1 can force the DB cluster to scale\.

Until that time, your Aurora Serverless v1 DB cluster continues looking for a scaling point and behaves according to its `TimeoutAction` setting\. That is, if it can't find a scaling point before timing out, it abandons the capacity change if it's configured to `RollbackCapacityChange`\. Or it forces the change if it's set to `ForceApplyCapacityChange`\. As with any change that's forced without an appropriate scaling point, this might interrupt your workload\.

For more information, see [Timeout action for capacity changes](#aurora-serverless.how-it-works.timeout-action)\.

## Aurora Serverless v1 and failover<a name="aurora-serverless.failover"></a>

 If the DB instance for an Aurora Serverless v1 DB cluster becomes unavailable or the Availability Zone \(AZ\) it is in fails, Aurora recreates the DB instance in a different AZ\. We refer to this capability as automatic multi\-AZ failover\. 

 This failover mechanism takes longer than for an Aurora provisioned cluster\. The Aurora Serverless v1 failover time is currently undefined because it depends on demand and capacity availability in other AZs within the given AWS Region\. 

 Because Aurora separates computation capacity and storage, the storage volume for the cluster is spread across multiple AZs\. Your data remains available even if outages affect the DB instance or the associated AZ\. 

## Aurora Serverless v1 and snapshots<a name="aurora-serverless.snapshots"></a>

 The cluster volume for an Aurora Serverless v1 cluster is always encrypted\. You can choose the encryption key, but you can't disable encryption\. To copy or share a snapshot of an Aurora Serverless v1 cluster, you encrypt the snapshot using your own AWS Key Management Service customer master key \(CMK\)\. For more information, see [Copying a DB cluster snapshot ](https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/USER_CopySnapshot.html)\. To learn more about encryption and Amazon Aurora, see [Encrypting Amazon Aurora resources](https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/Overview.Encryption.html#Overview.Encryption.Enabling)\. 